<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>RoomieRadar | My Profile</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script>

    tailwind.config = {

      theme: {

        extend: {

          colors: {

            primary: '#e75480',

            darkBg: '#0f0a1e',

            textMuted: '#b0b0b0',

          },

        },

      },

    };

  </script>

  <style>

    body {

      background: linear-gradient(180deg, #3b0a45, #000);

      color: white;

      font-family: 'Inter', sans-serif;

      display: flex;

      justify-content: center;

      align-items: center;

      min-height: 100vh;

      overflow: hidden;

    }

    .card {

      background: rgba(255, 255, 255, 0.08);

      backdrop-filter: blur(20px);

      border-radius: 30px;

      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);

      width: 370px;

      height: 600px;

      padding: 20px;

      position: relative;

      overflow-y: auto;

      scrollbar-width: thin;

      scrollbar-color: #e75480 #2e073f;

    }

    input, textarea, select {

      background: rgba(255,255,255,0.1);

      border: none;

      outline: none;

      color: white;

      border-radius: 10px;

      padding: 6px 10px;

      width: 100%;

      resize: none;

    }

    select option {

      color: black;

    }

    button:disabled {

      opacity: 0.6;

      cursor: not-allowed;

    }

  </style>

</head>

<body>

  <div class="card">

    <!-- Header -->

    <div class="text-center mb-5">

      <div class="flex flex-col items-center mt-2">

        <label for="photoUpload" class="cursor-pointer">

          <img id="profile-photo" src="../static/images/default-avatar.png" alt="Profile"

               class="w-24 h-24 rounded-full border-4 border-primary shadow-lg object-cover">

        </label>

        <input type="file" id="photoUpload" class="hidden" accept="image/*">

        <h2 id="profile-username" class="text-xl font-semibold mt-3">Loading...</h2>

        <p id="profile-email" class="text-sm text-textMuted">Loading...</p>

      </div>

    </div>



    <!-- Editable Fields -->

    <div class="space-y-3 text-sm pb-5">

      <div>

        <label class="block text-textMuted mb-1">Pronouns</label>

        <select id="profile-pronouns">

          <option value="">-- Select Pronouns --</option>

          <option value="she/her">She / Her</option>

          <option value="he/him">He / Him</option>

          <option value="they/them">They / Them</option>

          <option value="other">Other</option>

        </select>

      </div>



      <div>

        <label class="block text-textMuted mb-1">Bio</label>

        <textarea id="profile-bio" rows="2" placeholder="Write a short bio..."></textarea>

      </div>



      <div>

        <label class="block text-textMuted mb-1">Description</label>

        <textarea id="profile-description" rows="2" placeholder="Describe yourself..."></textarea>

      </div>



      <div>

        <label class="block text-textMuted mb-1">Hobbies</label>

        <input id="profile-hobbies" placeholder="e.g., Reading, Painting, Hiking" />

      </div>



      <div>

        <label class="block text-textMuted mb-1">Status</label>

        <select id="profile-status">

          <option value="">-- Select --</option>

          <option value="Job">Job</option>

          <option value="Student">Student</option>

        </select>

      </div>



      <div id="occupation-field" class="hidden">

        <label class="block text-textMuted mb-1">Occupation / Course</label>

        <input id="profile-occupation" placeholder="e.g., Software Engineer or B.Tech CSE" />

      </div>

    </div>



    <!-- Save Button at bottom -->

    <div class="mt-6 flex justify-center">

      <button id="saveBtn" class="bg-primary text-white px-5 py-2 rounded-full shadow-lg text-sm font-semibold w-full">

        üíæ Save

      </button>

    </div>

  </div>



  <script>

    const API_BASE = "http://localhost:3000/profile";



    async function loadProfile() {

      try {

        const res = await fetch(`${API_BASE}/me`, {

          method: "GET",

          credentials: "include", // ensures session cookie sent

        });



        if (!res.ok) {

          const errText = await res.text();

          console.error("Server Error:", errText);

          throw new Error("Failed to fetch profile");

        }



        const data = await res.json();

        console.log("Loaded profile:", data);



        document.getElementById("profile-username").textContent = data.username || "User";

        document.getElementById("profile-email").textContent = data.email || "No email";

        document.getElementById("profile-pronouns").value = data.pronouns || "";

        document.getElementById("profile-bio").value = data.bio || "";

        document.getElementById("profile-description").value = data.description || "";

        document.getElementById("profile-hobbies").value = data.hobbies || "";

        document.getElementById("profile-status").value = data.status || "";

        document.getElementById("profile-occupation").value = data.occupation || "";



        if (data.photo) document.getElementById("profile-photo").src = data.photo;



        toggleOccupationField(data.status);

      } catch (err) {

        console.error("‚ùå Load error:", err);

        document.getElementById("profile-username").textContent = "Error Loading";

        document.getElementById("profile-email").textContent = "Try again later";

      }

    }



    function toggleOccupationField(value) {

      document.getElementById("occupation-field").classList.toggle("hidden", !value);

    }



    document.getElementById("profile-status").addEventListener("change", (e) => {

      toggleOccupationField(e.target.value);

    });



    document.getElementById("photoUpload").addEventListener("change", (e) => {

      const file = e.target.files[0];

      if (file) document.getElementById("profile-photo").src = URL.createObjectURL(file);

    });



    document.getElementById("saveBtn").addEventListener("click", async () => {

      const formData = new FormData();

      formData.append("pronouns", document.getElementById("profile-pronouns").value);

      formData.append("bio", document.getElementById("profile-bio").value);

      formData.append("description", document.getElementById("profile-description").value);

      formData.append("hobbies", document.getElementById("profile-hobbies").value);

      formData.append("status", document.getElementById("profile-status").value);

      formData.append("occupation", document.getElementById("profile-occupation").value);



      const photo = document.getElementById("photoUpload").files[0];

      if (photo) formData.append("photo", photo);



      const btn = document.getElementById("saveBtn");

      btn.disabled = true;

      btn.textContent = "Saving...";



      try {

        const res = await fetch(`${API_BASE}/update`, {

          method: "POST",

          credentials: "include",

          body: formData,

        });



        const data = await res.json();

        if (!res.ok) throw new Error(data.error || "Failed");



        alert("‚úÖ Profile updated!");

        loadProfile();

      } catch (err) {

        console.error("Save failed:", err);

        alert("‚ùå " + err.message);

      } finally {

        btn.disabled = false;

        btn.textContent = "üíæ Save";

      }

    });



    loadProfile();

  </script>

</body>

</html>